<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>가위바위보 미니게임</title>
<style>
  :root{
    --bg:#f6f8fb;
    --card:#ffffff;
    --accent:#3DADFF;
    --ok:#2ecc71;
    --bad:#e74c3c;
    --muted:#777;
    font-family: "Segoe UI", Roboto, "Noto Sans KR", system-ui, -apple-system, "Helvetica Neue", Arial;
  }
  html,body{height:100%;margin:0;background:var(--bg);color:#111}
  .wrap{
    max-width:900px;margin:28px auto;padding:18px;
  }
  header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
  header h1{font-size:20px;margin:0}
  .board{
    display:grid;grid-template-columns: 1fr 320px;gap:16px;
  }
  .card{
    background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 20px rgba(20,30,50,0.06);
  }

  /* 왼쪽 : 게임영역 */
  .game-area{display:flex;flex-direction:column;gap:12px}
  .status {
    display:flex;justify-content:space-between;align-items:center;gap:8px;
  }
  .status .result{
    font-weight:700;font-size:18px;
  }
  .status .sub { color:var(--muted); font-size:13px }
  .choices{
    display:flex;gap:12px;justify-content:center;padding:6px;
  }
  .choice-btn{
    width:110px;height:110px;border-radius:12px;border:2px solid transparent;
    background:linear-gradient(180deg,#fff,#f7fbff);
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    cursor:pointer;user-select:none;transition:transform .08s ease, box-shadow .12s, border-color .12s;
    font-weight:700;font-size:14px;
    box-shadow:0 4px 14px rgba(30,60,120,0.06);
  }
  .choice-btn:active{transform:translateY(2px) scale(.99)}
  .choice-btn.disabled{opacity:.5;pointer-events:none}
  .choice-label{font-size:28px;margin-bottom:6px}
  .choice-info{font-size:13px;color:var(--muted)}

  .choice-btn.selected{border-color:var(--accent); box-shadow:0 8px 20px rgba(61,173,255,0.18)}
  .choice-btn.win{border-color:var(--ok); box-shadow:0 10px 26px rgba(46, 204, 113, 0.12)}
  .choice-btn.lose{border-color:var(--bad); box-shadow:0 10px 26px rgba(231, 76, 60, 0.12)}

  .vs-area{
    display:flex;align-items:center;justify-content:center;gap:18px;padding:8px;margin-top:6px;
  }
  .player, .computer{
    width:140px;height:140px;border-radius:12px;background:#fbfdff;border:1px solid #eef4ff;
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    font-weight:700;
  }
  .player .lbl, .computer .lbl{font-size:12px;color:var(--muted)}
  .player .pick, .computer .pick{font-size:40px;margin-top:6px}

  .controls{display:flex;gap:8px;align-items:center;justify-content:flex-end}
  .controls button{padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#fff;cursor:pointer}
  .controls button.ghost{background:#f0f6ff;color:#036; border:1px solid #e6f1ff}

  /* 오른쪽 : 점수판 / 히스토리 */
  .side{
    display:flex;flex-direction:column;gap:12px;
  }
  .score{
    display:flex;gap:12px;align-items:center;justify-content:space-between;
  }
  .score .numbers{display:flex;gap:12px}
  .num{background:#fff;padding:10px;border-radius:8px;min-width:80px;text-align:center}
  .num .v{font-weight:800;font-size:20px}
  .history{max-height:360px;overflow:auto;padding:8px;border-radius:8px;background:#fbfdff;border:1px solid #eef5ff}
  .history-item{display:flex;justify-content:space-between;padding:8px;border-bottom:1px dashed #eee;font-size:14px}
  .history-item .who{color:var(--muted);font-size:13px}

  footer{margin-top:16px;color:var(--muted);font-size:13px;text-align:center}

  /* responsive */
  @media(max-width:860px){
    .board{grid-template-columns:1fr; }
    .side{order:2}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>가위바위보 미니게임 ⚔️</h1>
      <div style="color:var(--muted);font-size:13px">R:가위, P:바위, S:보 (키보드 단축키)</div>
    </header>

    <div class="board">
      <!-- 게임 영역 -->
      <section class="card game-area" aria-labelledby="game-title">
        <h2 id="game-title" style="margin:0 0 6px 0;font-size:16px">대전</h2>

        <div class="status">
          <div>
            <div class="result" id="resultText">시작하려면 선택하세요</div>
            <div class="sub" id="subText">컴퓨터와 대결합니다</div>
          </div>
          <div class="controls">
            <button id="resetBtn" class="ghost">초기화</button>
            <button id="autoPlayBtn">자동 대전(5회)</button>
          </div>
        </div>

        <div class="choices" role="group" aria-label="선택">
          <button class="choice-btn" data-move="scissors" id="btn-scissors" aria-pressed="false">
            <div class="choice-label">✌️</div>
            <div class="choice-info">가위</div>
          </button>

          <button class="choice-btn" data-move="rock" id="btn-rock" aria-pressed="false">
            <div class="choice-label">✊</div>
            <div class="choice-info">바위</div>
          </button>

          <button class="choice-btn" data-move="paper" id="btn-paper" aria-pressed="false">
            <div class="choice-label">🖐</div>
            <div class="choice-info">보</div>
          </button>
        </div>

        <div class="vs-area" aria-live="polite">
          <div class="player" aria-label="플레이어">
            <div class="lbl">플레이어</div>
            <div class="pick" id="playerPick">—</div>
          </div>

          <div style="font-weight:700;color:#666">VS</div>

          <div class="computer" aria-label="컴퓨터">
            <div class="lbl">컴퓨터</div>
            <div class="pick" id="computerPick">—</div>
          </div>
        </div>
      </section>

      <!-- 사이드: 점수 / 히스토리 -->
      <aside class="side">
        <div class="card score" aria-labelledby="score-title">
          <div>
            <div id="score-title" style="font-weight:700;margin-bottom:8px">점수판</div>
            <div class="numbers">
              <div class="num"><div style="font-size:12px;color:var(--muted)">승</div><div class="v" id="winCount">0</div></div>
              <div class="num"><div style="font-size:12px;color:var(--muted)">무</div><div class="v" id="drawCount">0</div></div>
              <div class="num"><div style="font-size:12px;color:var(--muted)">패</div><div class="v" id="loseCount">0</div></div>
            </div>
          </div>
          <div style="text-align:right">
            <div style="font-size:12px;color:var(--muted)">연속승리</div>
            <div style="font-weight:800;font-size:18px" id="streak">0</div>
          </div>
        </div>

        <div class="card">
          <div style="font-weight:700;margin-bottom:8px">히스토리 (최근 10)</div>
          <div class="history" id="historyList" aria-live="polite"></div>
        </div>

        <div class="card" style="text-align:center">
          <button id="shareBtn" class="ghost">결과 공유(복사)</button>
        </div>
      </aside>
    </div>

    <footer>
      즐겁게 플레이하세요 — 필요하면 기능 추가해줄게!
    </footer>
  </div>

<script>
/*
  간단한 로직 설명:
  - 사용자 버튼 클릭 또는 키보드 입력으로 move 결정
  - 컴퓨터는 랜덤으로 move 선택
  - 승패 계산 후 UI 업데이트 (점수, 스태릭, 히스토리)
  - 로컬스토리지에 score 저장 (win/draw/lose, streak)
*/

// util
const MOVES = ["scissors","rock","paper"];
const EMOJI = { scissors:"✌️", rock:"✊", paper:"🖐" };
const KOREA = { scissors:"가위", rock:"바위", paper:"보" };

function pickRandom() {
  return MOVES[Math.floor(Math.random()*MOVES.length)];
}
function decide(player, cpu) {
  if (player === cpu) return "draw";
  // 가위 beats 보, 바위 beats 가위, 보 beats 바위
  if ((player==="scissors" && cpu==="paper") ||
      (player==="rock" && cpu==="scissors") ||
      (player==="paper" && cpu==="rock")) {
    return "win";
  }
  return "lose";
}

// DOM
const btns = {
  scissors: document.getElementById("btn-scissors"),
  rock: document.getElementById("btn-rock"),
  paper: document.getElementById("btn-paper"),
};
const playerPickEl = document.getElementById("playerPick");
const computerPickEl = document.getElementById("computerPick");
const resultText = document.getElementById("resultText");
const subText = document.getElementById("subText");

const winEl = document.getElementById("winCount");
const drawEl = document.getElementById("drawCount");
const loseEl = document.getElementById("loseCount");
const streakEl = document.getElementById("streak");
const historyEl = document.getElementById("historyList");

const resetBtn = document.getElementById("resetBtn");
const autoPlayBtn = document.getElementById("autoPlayBtn");
const shareBtn = document.getElementById("shareBtn");

// state (로컬스토리지 연동)
const STORAGE_KEY = "rps_score_v1";
let state = {
  win:0, draw:0, lose:0, streak:0, history:[]
};
function loadState(){
  try{
    const s = JSON.parse(localStorage.getItem(STORAGE_KEY));
    if (s && typeof s === "object"){
      state = Object.assign(state, s);
      if (!Array.isArray(state.history)) state.history = [];
    }
  }catch(e){}
}
function saveState(){
  try{ localStorage.setItem(STORAGE_KEY, JSON.stringify({
    win: state.win, draw: state.draw, lose: state.lose, streak: state.streak, history: state.history.slice(0,50)
  })); }catch(e){}
}

// UI 업데이트
function renderScore(){
  winEl.textContent = state.win;
  drawEl.textContent = state.draw;
  loseEl.textContent = state.lose;
  streakEl.textContent = state.streak;
}
function renderHistory(){
  historyEl.innerHTML = "";
  const list = state.history.slice(0,10);
  if (list.length===0){ historyEl.innerHTML = '<div style="color:var(--muted);padding:12px;text-align:center">아직 플레이가 없습니다</div>'; return;}
  list.forEach(item=>{
    const div = document.createElement("div");
    div.className = "history-item";
    div.innerHTML = `<div><strong>${EMOJI[item.player]}</strong> ${KOREA[item.player]} → <strong>${EMOJI[item.cpu]}</strong> ${KOREA[item.cpu]}</div>
                     <div class="who">${item.result === "win" ? "승" : item.result === "lose" ? "패" : "무"}</div>`;
    historyEl.appendChild(div);
  });
}

// highlight 상태 초기화
function clearChoiceHighlights(){
  Object.values(btns).forEach(b => {
    b.classList.remove("selected","win","lose");
    b.setAttribute("aria-pressed","false");
  });
}

// 플레이 한 판 실행 (버튼 또는 키보드)
let disabled = false;
async function playRound(playerMove){
  if (disabled) return;
  disabled = true;
  clearChoiceHighlights();

  // 사용자 선택 하이라이트
  const userBtn = btns[playerMove];
  userBtn.classList.add("selected");
  userBtn.setAttribute("aria-pressed","true");
  playerPickEl.textContent = EMOJI[playerMove];

  // 잠깐 딜레이(애니메이션 느낌)
  resultText.textContent = "컴퓨터 선택 중...";
  subText.textContent = "잠시만 기다려주세요";
  // animate CPU thinking
  computerPickEl.textContent = "🤖";
  await new Promise(r => setTimeout(r, 600 + Math.random()*300));

  const cpuMove = pickRandom();
  computerPickEl.textContent = EMOJI[cpuMove];

  // 결과 결정
  const res = decide(playerMove, cpuMove);

  // 시각적 강조
  if (res === "win") {
    userBtn.classList.add("win");
    resultText.textContent = "승리!";
    subText.textContent = `${KOREA[playerMove]}이(가) ${KOREA[cpuMove]}을(를) 이겼습니다. 🎉`;
    state.win++;
    state.streak = (state.streak || 0) + 1;
  } else if (res === "lose"){
    userBtn.classList.add("lose");
    resultText.textContent = "패배";
    subText.textContent = `${KOREA[cpuMove]}이(가) ${KOREA[playerMove]}을(를) 이겼습니다. 💥`;
    state.lose++;
    state.streak = 0;
  } else {
    resultText.textContent = "무승부";
    subText.textContent = "비겼습니다.";
    state.draw++;
    // 무승부는 streak에 영향 없음
  }

  // 히스토리 갱신 (앞쪽 삽입)
  state.history.unshift({ player:playerMove, cpu:cpuMove, result:res, at: Date.now() });
  if (state.history.length > 50) state.history.length = 50;

  renderScore();
  renderHistory();
  saveState();

  // 잠깐 후 입력 허용
  setTimeout(()=>{ disabled=false; }, 300);
}

// 초기화
function resetAll(){
  if (!confirm("점수와 히스토리를 초기화하시겠습니까?")) return;
  state = { win:0, draw:0, lose:0, streak:0, history:[] };
  saveState();
  renderScore();
  renderHistory();
  clearChoiceHighlights();
  playerPickEl.textContent = "—";
  computerPickEl.textContent = "—";
  resultText.textContent = "초기화되었습니다. 선택하세요.";
  subText.textContent = "R:가위 P:바위 S:보";
}

// 자동 플레이 예시(간단)
async function autoPlay(times = 5, interval=600){
  autoPlayBtn.disabled = true;
  for (let i=0;i<times;i++){
    const pick = pickRandom();
    await playRound(pick);
    await new Promise(r => setTimeout(r, interval));
  }
  autoPlayBtn.disabled = false;
}

// 공유 (결과 텍스트 복사)
function shareResult(){
  const total = state.win + state.draw + state.lose;
  const txt = `가위바위보 결과 — 총 ${total}판: 승 ${state.win} / 무 ${state.draw} / 패 ${state.lose} (최대 연승 ${state.streak})`;
  navigator.clipboard?.writeText ? navigator.clipboard.writeText(txt).then(()=>{
    alert("결과가 클립보드에 복사되었습니다.");
  }).catch(()=>{ alert("복사에 실패했습니다."); }) : alert(txt);
}

// 바인딩
Object.entries(btns).forEach(([move, btn])=>{
  btn.addEventListener("click", ()=> playRound(move));
});

// 키보드: R(가위) P(바위) S(보). 한글 입력 시 혼동 없게 영어 문자 기준.
document.addEventListener("keydown", (e)=>{
  if (e.key.toLowerCase() === 'r') playRound("scissors");
  if (e.key.toLowerCase() === 'p') playRound("rock");
  if (e.key.toLowerCase() === 's') playRound("paper");
});

// 기타 버튼
resetBtn.addEventListener("click", resetAll);
autoPlayBtn.addEventListener("click", ()=> autoPlay(5, 600));
shareBtn.addEventListener("click", shareResult);

// 로드 시 초기 렌더
loadState();
renderScore();
renderHistory();
</script>
</body>
</html>
